<!DOCTYPE html>
<html>
<head>
<title>Ruta en Bicicleta con Google Maps</title>
<style>
    /* 
    * Always set the map height explicitly to define the size of the div element
    * that contains the map. 
    */
    #map {
    height: 100%;
    }

    /* 
    * Optional: Makes the sample page fill the window. 
    */
    html,
    body {
    height: 100%;
    margin: 0;
    padding: 0;
    }

    #floating-panel {
    position: absolute;
    top: 10px;
    left: 25%;
    z-index: 5;
    background-color: #fff;
    padding: 5px;
    border: 1px solid #999;
    text-align: center;
    font-family: "Roboto", "sans-serif";
    line-height: 30px;
    padding-left: 10px;
    }
</style>
</head>
<body>
    <div id="map"></div>
<script>

    // Note: This example requires that you consent to location sharing when
    // prompted by your browser. If you see the error "The Geolocation service
    // failed.", it means you probably did not give permission for the browser to
    // locate you.
    let map, infoWindow;

    function initMap() {
        map = new google.maps.Map(document.getElementById("map"), {
            center: { lat: -34.397, lng: 150.644 },
            zoom: 12,
        });
        infoWindow = new google.maps.InfoWindow();

        const locationButton = document.createElement("button");

        locationButton.textContent = "Pan to Current Location";
        locationButton.classList.add("custom-map-control-button");
        map.controls[google.maps.ControlPosition.TOP_CENTER].push(locationButton);
        locationButton.addEventListener("click", () => {
            // Try HTML5 geolocation.
            if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                const pos = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude,
                };

                infoWindow.setPosition(pos);
                infoWindow.setContent("Location found.");
                infoWindow.open(map);
                map.setCenter(pos);
                },
                () => {
                handleLocationError(true, infoWindow, map.getCenter());
                },
            );
            } else {
            // Browser doesn't support Geolocation
            handleLocationError(false, infoWindow, map.getCenter());
            }
        });
    }

    function handleLocationError(browserHasGeolocation, infoWindow, pos) {
    infoWindow.setPosition(pos);
    infoWindow.setContent(
        browserHasGeolocation
        ? "Error: The Geolocation service failed."
        : "Error: Your browser doesn't support geolocation.",
    );
    infoWindow.open(map);
    }

    window.initMap = initMap;


    async function getBikeRoute() {
        const apiKey = "AIzaSyDvy-VPCrz3BPBheH46uD8Hs1e85YTIjxk"; // Reemplaza con tu clave de API
        const url = "https://routes.googleapis.com/directions/v2:computeRoutes";

        const requestData = {
            origin: { address: "1600 Amphitheatre Parkway, Mountain View, CA" },
            destination: { address: "450 Serra Mall, Stanford, CA" },
            travelMode: "BICYCLE" // Especificar que es una ruta en bicicleta
        };

        try {
            const response = await fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "X-Goog-Api-Key": apiKey,
                    "X-Goog-FieldMask": "routes.duration,routes.distanceMeters"
                },
                body: JSON.stringify(requestData)
            });

            if (!response.ok) {
                throw new Error(`Error en la API: ${response.statusText}`);
            }

            const data = await response.json();
            console.log("Distancia:", data.routes[0].distanceMeters, "metros");
            console.log("Duración:", data.routes[0].duration);
        } catch (error) {
            console.error("Error obteniendo la ruta:", error);
        }
    }

    // Llamar a la función
    getBikeRoute();

    
</script>

<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDvy-VPCrz3BPBheH46uD8Hs1e85YTIjxk&callback=initMap&v=weekly" defer></script>

</body>
</html>